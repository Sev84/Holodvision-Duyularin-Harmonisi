<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PİKSENFONİ - Erişilebilir Sanat Galerisi</title>
    
    <!-- Gerekli Kütüphaneler (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    
    <!-- Babel: JSX kodunu tarayıcıda çalıştırmak için -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Temel Sayfa Stilleri -->
    <style>
        body {
          margin: 0;
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
            'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
            sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          background-color: #0c0a18;
          color: #fff;
        }
        #qr-reader video {
            border-style: none !important;
        }
        /* Scrollbar stilleri */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a2e;
        }
        ::-webkit-scrollbar-thumb {
            background: #e94560;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #f06a7e;
        }
        /* Animasyon için */
        .fade-in-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .fade-in-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 300ms, transform 300ms;
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 300ms, transform 300ms;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <audio id="bg-music-player" src="https://raw.githubusercontent.com/Sev84/Holodvision-Duyularin-Harmonisi/main/fon%20muzik.mp3" loop></audio>
    <script type="text/babel">
    
        const { useState, useEffect, useRef, useCallback } = React;

        // --- API ANAHTARI ---
        const ELEVENLABS_API_KEY = "sk_06e523c1c3688282e8421a4da028fed650a11643c6d33879"; 
        const GEMINI_API_KEY = "AIzaSyAZMMSy7N-i82s-eNJNZurylx_fGbIyhlk";

        // --- ICONS ---
        const Palette = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></svg>);
        const Eye = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>);
        const Music = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>);
        const Camera = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>);
        const Zap = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>);
        const XCircle = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>);
        const Loader = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="animate-spin" {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>);
        const Volume2 = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>);
        const VolumeX = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><line x1="23" y1="9" x2="17" y2="15"/><line x1="17" y1="9" x2="23" y2="15"/></svg>);
        const Cpu = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>);
        const Users = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><path d="M20 8v6"/><path d="M23 11h-6"/></svg>);
        const PlayCircle = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>);
        const Sparkles = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m12 3-1.9 5.8-5.8 1.9 5.8 1.9L12 18l1.9-5.8 5.8-1.9-5.8-1.9L12 3z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>);
        const Send = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>);
        const Mic = (props) => (<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>);

        // --- HOOKS ---
        const useOnScreen = (options) => {
            const ref = useRef(null);
            const [isVisible, setIsVisible] = useState(false);

            useEffect(() => {
                const observer = new IntersectionObserver(([entry]) => {
                    if (entry.isIntersecting) {
                        setIsVisible(true);
                        observer.unobserve(entry.target);
                    }
                }, options);

                const currentRef = ref.current;
                if (currentRef) { observer.observe(currentRef); }
                return () => { if (currentRef) { observer.unobserve(currentRef); } };
            }, [ref, options]);

            return [ref, isVisible];
        };
        
        // --- BİLEŞENLER ---
        
        const WelcomeModal = ({ isOpen, onClose }) => {
            const textToSpeak = `Piksenfoni, Duyuların Harmonisi Sanat Atölyesi'ne hoş geldiniz. Bu platform, görme engelli bireylerin sanatı işitsel ve dokunsal yollarla deneyimlemesi için tasarlanmıştır. Sayfayı aşağı kaydırarak proje detaylarını ve eser galerisini keşfedebilirsiniz. Galerideki eserlerin üzerine gelerek sesli ipuçları alabilir, QR kod tarayıcı ile eserlere özel bestelenmiş müzikleri dinleyebilirsiniz. Deneyime başlamak için Başla butonuna tıklayabilirsiniz.`;
            const hasSpoken = useRef(false);

            const speak = useCallback(() => {
                if(hasSpoken.current) return;
                speakText(textToSpeak);
                hasSpoken.current = true;
            }, []);

            useEffect(() => {
                if (isOpen) {
                    const handleVoicesChanged = () => {
                        if (isOpen) {
                            setTimeout(speak, 100);
                        }
                    };
                    const voices = window.speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        handleVoicesChanged();
                    } else {
                        window.speechSynthesis.onvoiceschanged = handleVoicesChanged;
                    }
                    return () => {
                        window.speechSynthesis.onvoiceschanged = null;
                    };
                }
            }, [isOpen, speak]);

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-50 p-4">
                    <div className="bg-gradient-to-br from-gray-900 to-[#1a1a2e] p-8 rounded-2xl shadow-2xl border border-red-500/50 max-w-lg w-full text-center">
                        <img src="https://raw.githubusercontent.com/Sev84/Holodvision-Duyularin-Harmonisi/main/logo1111111.png" alt="PİKSENFONİ Logo" className="mx-auto mb-4 h-20" onError={(e) => { e.target.style.display='none'; }}/>
                        <h2 className="text-3xl font-bold text-red-400 mb-4">PİKSENFONİ'ye Hoş Geldiniz!</h2>
                        <p className="text-gray-300 mb-8">Bu platform, görme engelli bireylerin sanatı işitsel ve dokunsal yollarla deneyimlemesi için tasarlanmıştır. Lütfen yönergeleri dinleyin.</p>
                        <div className="flex flex-col sm:flex-row gap-4 justify-center">
                            <button onClick={onClose} className="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg transition-colors w-full sm:w-auto">Deneyime Başla</button>
                            <button onClick={() => speakText(textToSpeak)} className="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-lg transition-colors flex items-center justify-center w-full sm:w-auto"><PlayCircle className="mr-2" /> Tekrar Dinle</button>
                        </div>
                    </div>
                </div>
            );
        };

        const AnimatedSection = ({ children, ...props }) => {
            const [ref, isVisible] = useOnScreen({ threshold: 0.1 });
            return ( <section ref={ref} className={`fade-in-section ${isVisible ? 'is-visible' : ''} py-20 px-4 sm:px-6 lg:px-8`} {...props}> {children} </section> );
        };

        const ParticleBackground = () => {
            const canvasRef = useRef(null);
            useEffect(() => {
                const canvas = canvasRef.current; const ctx = canvas.getContext('2d');
                let particles = []; canvas.width = window.innerWidth; canvas.height = window.innerHeight;
                const createParticles = () => {
                    particles = []; let numberOfParticles = (canvas.height * canvas.width) / 9000;
                    for (let i = 0; i < numberOfParticles; i++) { particles.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: Math.random() * 2 + 1, speedX: Math.random() * 1 - 0.5, speedY: Math.random() * 1 - 0.5, }); }
                };
                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    for (let i = 0; i < particles.length; i++) {
                        let p = particles[i]; p.x += p.speedX; p.y += p.speedY;
                        if (p.x > canvas.width || p.x < 0) p.speedX *= -1;
                        if (p.y > canvas.height || p.y < 0) p.speedY *= -1;
                        ctx.fillStyle = 'rgba(233, 69, 96, 0.5)';
                        ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2); ctx.fill();
                    }
                    requestAnimationFrame(animate);
                };
                createParticles(); animate();
                const handleResize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; createParticles(); };
                window.addEventListener('resize', handleResize);
                return () => window.removeEventListener('resize', handleResize);
            }, []);
            return <canvas ref={canvasRef} className="fixed top-0 left-0 w-full h-full -z-10" />;
        };

        const Navbar = () => {
            const [isOpen, setIsOpen] = useState(false);
            const navLinks = [ { href: "#home", text: "Ana Sayfa" }, { href: "#project", text: "Proje" }, { href: "#gallery", text: "Galeri" }, { href: "#contact", text: "İletişim" }, ];
            return (
                <nav className="bg-black/20 backdrop-blur-md fixed w-full z-30 top-0">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex items-center justify-between h-16">
                            <div className="flex-shrink-0"> <img className="h-10" src="https://raw.githubusercontent.com/Sev84/Holodvision-Duyularin-Harmonisi/main/logo1111111.png" alt="Logo"/> </div>
                            <div className="hidden md:block">
                                <div className="ml-10 flex items-baseline space-x-4"> {navLinks.map(link => ( <a key={link.href} href={link.href} className="text-gray-300 hover:bg-red-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors">{link.text}</a> ))} </div>
                            </div>
                            <div className="-mr-2 flex md:hidden">
                                <button onClick={() => setIsOpen(!isOpen)} className="bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none">
                                    <svg className={`${isOpen ? 'hidden' : 'block'} h-6 w-6`} stroke="currentColor" fill="none" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                                    <svg className={`${isOpen ? 'block' : 'hidden'} h-6 w-6`} stroke="currentColor" fill="none" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div className={`${isOpen ? 'block' : 'hidden'} md:hidden`}>
                        <div className="px-2 pt-2 pb-3 space-y-1 sm:px-3"> {navLinks.map(link => ( <a key={link.href} href={link.href} className="text-gray-300 hover:bg-red-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium transition-colors">{link.text}</a> ))} </div>
                    </div>
                </nav>
            );
        };

        const InfoCard = ({ icon, title, children }) => (
            <div className="bg-gray-800/50 backdrop-blur-sm p-6 rounded-xl border border-gray-700 text-center transform hover:-translate-y-2 transition-transform duration-300">
                <div className="text-red-500 mb-4 mx-auto w-16 h-16 flex items-center justify-center bg-gray-900 rounded-full">{icon}</div>
                <h3 className="text-xl font-bold mb-2">{title}</h3>
                <p className="text-gray-400">{children}</p>
            </div>
        );

        const ArtCard = ({ item, onSelect, onHover }) => (
          <div className="bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl overflow-hidden shadow-lg transform hover:scale-105 transition-transform duration-300 cursor-pointer" onMouseEnter={onHover} onClick={() => onSelect(item)}>
            <img src={item.imageUrl} alt={item.artwork} className="w-full h-56 object-cover" onError={(e) => { e.target.onerror = null; e.target.src=`https://placehold.co/600x400/1f2937/ffffff?text=Resim+Yüklenemedi`; }}/>
            <div className="p-4">
              <h3 className="text-xl font-bold text-red-300">{item.artwork}</h3>
              <p className="text-sm text-gray-300 mb-1">{item.artist}</p>
              <p className="text-sm text-gray-400 mb-2 italic">🎨 {item.category}</p>
              <p className="text-sm text-gray-400 mb-4 h-12 overflow-hidden">{item.description}</p>
            </div>
          </div>
        );

        const QrScanner = ({ onScanSuccess, onScanError, onStop }) => {
          useEffect(() => {
            const html5QrCode = new Html5Qrcode("qr-reader");
            const qrCodeSuccessCallback = (decodedText, decodedResult) => { onScanSuccess(decodedText); html5QrCode.stop().catch(err => console.error("Tarama durdurulamadı.", err)); };
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback).catch(err => { onScanError("Kamera başlatılamadı. Lütfen kamera izni verdiğinizden emin olun."); });
            return () => { if (html5QrCode.isScanning) { html5QrCode.stop().catch(err => console.error("Temizleme sırasında tarama durdurulamadı.", err)); } };
          }, [onScanSuccess, onScanError]);
          return (
            <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                <div className="bg-gray-900 p-4 rounded-2xl shadow-2xl border border-gray-700 w-full max-w-md">
                    <div id="qr-reader" className="rounded-lg overflow-hidden"></div>
                    <p className="text-center text-gray-300 mt-4">QR kodu kameraya gösterin</p>
                    <button onClick={onStop} className="w-full mt-4 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center transition-colors"> <XCircle className="mr-2" /> Kapat </button>
                </div>
            </div>
          );
        };
        
        // --- SESLENDİRME FONKSİYONU ---
        let elevenLabsAudio = new Audio();
        const speakText = async (text, setLoading) => {
            if (setLoading) setLoading(true);
            
            // Mevcut tüm sesleri durdur
            window.speechSynthesis.cancel();
            if (elevenLabsAudio && !elevenLabsAudio.paused) {
                elevenLabsAudio.pause();
                elevenLabsAudio.currentTime = 0;
            }

            // ElevenLabs API Anahtarı varsa onu kullan
            if (ELEVENLABS_API_KEY) {
                const VOICE_ID = '21m00Tcm4TlvDq8ikWAM'; // Rachel - Popüler ve stabil bir ses
                const url = `https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`;
                const options = {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': ELEVENLABS_API_KEY,
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_multilingual_v2',
                        voice_settings: { stability: 0.5, similarity_boost: 0.75 },
                    }),
                };
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        const errorBody = await response.json().catch(() => ({ detail: { message: response.statusText } }));
                        const errorMessage = errorBody.detail ? errorBody.detail.message : `HTTP status ${response.status}`;
                        throw new Error(`ElevenLabs API hatası: ${errorMessage}`);
                    }
                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    elevenLabsAudio = new Audio(audioUrl);
                    elevenLabsAudio.play();
                    elevenLabsAudio.onended = () => { if (setLoading) setLoading(false); };
                    return; 
                } catch (error) {
                    console.error("ElevenLabs sesi oynatılamadı, tarayıcı sesine geçiliyor:", error);
                }
            }
            
            // ElevenLabs başarısız olursa veya anahtar yoksa tarayıcı sesini kullan
            console.warn("ElevenLabs API anahtarı bulunamadı veya hata oluştu. Tarayıcı sesi kullanılıyor.");
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'tr-TR';
            utterance.rate = 0.9;
            const voices = window.speechSynthesis.getVoices();
            const turkishVoice = voices.find(voice => voice.lang === 'tr-TR');
            if (turkishVoice) { utterance.voice = turkishVoice; }
            utterance.onend = () => { if (setLoading) setLoading(false); };
            window.speechSynthesis.speak(utterance);
        };


        const ArtworkDetailModal = ({ artwork, onClose, bgMusicRef, isBgMusicPlaying }) => {
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [analysisText, setAnalysisText] = useState("");
            const [chatHistory, setChatHistory] = useState([]);
            const [userQuestion, setUserQuestion] = useState("");
            const [isChatting, setIsChatting] = useState(false);
            const [isListening, setIsListening] = useState(false);
            const recognitionRef = useRef(null);

            useEffect(() => {
                if(isBgMusicPlaying) bgMusicRef.current?.pause();
                return () => {
                    if(isBgMusicPlaying) bgMusicRef.current?.play();
                    window.speechSynthesis.cancel();
                    if (elevenLabsAudio && !elevenLabsAudio.paused) {
                        elevenLabsAudio.pause();
                    }
                };
            }, [isBgMusicPlaying, bgMusicRef]);


            const getArtAnalysis = async () => {
                if (!artwork) return;
                setIsAnalyzing(true);
                setAnalysisText("");
                const prompt = `Sen bir sanat tarihçisisin. Görme engelli bir kullanıcı için ${artwork.artist} tarafından yapılan '${artwork.artwork}' adlı tabloyu canlı, duygusal ve erişilebilir bir dille betimle. Renklerin hissettirdiği duyguları, tablonun atmosferini, kullanılan teknikleri ve olası hikayesini anlat. Cevabın bilgilendirici ve şiirsel olsun.`;
                
                try {
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    const apiKey = "";
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) { throw new Error(`API call failed with status: ${response.status}`); }
                    const result = await response.json();
                    if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts[0].text) {
                        const text = result.candidates[0].content.parts[0].text;
                        setAnalysisText(text);
                        speakText(text, setIsAnalyzing);
                    } else { throw new Error("Modelden geçerli bir yanıt gelmedi."); }
                } catch (error) {
                    console.error("Gemini API error:", error);
                    const mockAnalysis = `[DEMO MODU] '${artwork.artwork}' adlı bu eser, ${artwork.artist} tarafından yapılmış, ${artwork.category} sanat akımının bir örneğidir. Sanatçı, bu eserde duyguları ve formları kendine has bir dille yorumlamıştır. Bu analiz, yapay zeka tarafından üretilmiştir. Canlı bağlantı kurulamadığında bu örnek metin gösterilir.`;
                    setAnalysisText(mockAnalysis);
                    speakText(mockAnalysis, setIsAnalyzing);
                }
            };

            const handleChatSubmit = async (e) => {
                e.preventDefault();
                if (!userQuestion.trim() || isChatting) return;

                const currentQuestion = userQuestion;
                const newHistory = [...chatHistory, { role: 'user', text: currentQuestion }];
                setChatHistory(newHistory);
                setUserQuestion("");
                setIsChatting(true);

                const prompt = `Bir sanat eseri hakkında sohbet ediyoruz. Eser: ${artwork.artist} tarafından yapılan '${artwork.artwork}'. Geçmiş konuşma: ${JSON.stringify(chatHistory)}. Kullanıcının yeni sorusu: "${currentQuestion}". Bu soruya bir sanat uzmanı gibi, eserin bağlamını dikkate alarak cevap ver.`;

                try {
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    const apiKey = "";
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                     if (!response.ok) { throw new Error(`API call failed with status: ${response.status}`); }
                    const result = await response.json();
                    if (result.candidates && result.candidates[0].content.parts[0].text) {
                        const botResponse = result.candidates[0].content.parts[0].text;
                        setChatHistory(prev => [...prev, { role: 'model', text: botResponse }]);
                        speakText(botResponse, setIsChatting);
                    } else { throw new Error("Modelden geçerli bir yanıt gelmedi."); }
                } catch (error) {
                     const mockResponse = "[DEMO MODU] Bu soruya şu an yanıt veremiyorum, ancak sanatçının bu dönemdeki diğer eserlerini inceleyebilirsiniz.";
                     setChatHistory(prev => [...prev, { role: 'model', text: mockResponse }]);
                     speakText(mockResponse, setIsChatting);
                }
            };

            const handleVoiceInput = () => {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                if (!SpeechRecognition) {
                    alert("Üzgünüz, tarayıcınız ses tanıma özelliğini desteklemiyor.");
                    return;
                }

                if (isListening) {
                    recognitionRef.current.stop();
                    setIsListening(false);
                    return;
                }

                const recognition = new SpeechRecognition();
                recognition.lang = 'tr-TR';
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;
                recognitionRef.current = recognition;

                recognition.onstart = () => setIsListening(true);
                recognition.onresult = (event) => setUserQuestion(event.results[0][0].transcript);
                recognition.onerror = (event) => { console.error('Ses tanıma hatası:', event.error); alert(`Ses tanıma hatası: ${event.error}`); };
                recognition.onend = () => setIsListening(false);
                recognition.start();
            };

            if (!artwork) return null;

            return (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-md flex items-center justify-center z-40 p-4 modal-enter-active">
                    <div className="bg-gradient-to-br from-gray-900 to-[#1a1a2e] p-6 rounded-2xl shadow-2xl border border-red-500/50 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                        <div className="flex justify-between items-center mb-4">
                            <h2 className="text-3xl font-bold text-red-400">{artwork.artwork}</h2>
                            <button onClick={onClose} className="text-gray-400 hover:text-white transition-colors"><XCircle size={28} /></button>
                        </div>
                        <img src={artwork.imageUrl} alt={artwork.artwork} className="w-full h-72 object-cover rounded-xl mb-4 shadow-lg" onError={(e) => { e.target.onerror = null; e.target.src=`https://placehold.co/800x600/1f2937/ffffff?text=Resim+Yüklenemedi`; }}/>
                        <p className="text-gray-300 mb-4 text-lg">{artwork.artist}</p>
                        <audio controls autoPlay className="w-full mb-4" src={artwork.musicUrl} aria-label={`${artwork.artwork} için müzik çalar`}>Tarayıcınız ses çalmayı desteklemiyor.</audio>
                        <p className="text-gray-400 mb-6">{artwork.description}</p>
                        
                        <div className="pt-6 border-t border-gray-700">
                            <button onClick={getArtAnalysis} disabled={isAnalyzing} className="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                {isAnalyzing ? <Loader /> : <Sparkles className="mr-2" />}
                                {isAnalyzing ? "Analiz Ediliyor..." : "✨ Sanatsal Analiz Al"}
                            </button>
                            {analysisText && (
                                <div className="mt-4 p-4 bg-gray-900/70 rounded-lg">
                                    <h4 className="font-bold text-lg text-red-300 mb-2">Sanatsal Analiz</h4>
                                    <p className="text-gray-300 whitespace-pre-wrap">{analysisText}</p>
                                    
                                    <div className="mt-6">
                                        <h4 className="font-bold text-lg text-red-300 mb-2">✨ Eserle Sohbet Et</h4>
                                        <div className="space-y-2 mb-4 h-40 overflow-y-auto p-2 bg-black/20 rounded">
                                            {chatHistory.map((msg, index) => (
                                                <div key={index} className={`p-2 rounded-lg ${msg.role === 'user' ? 'bg-blue-900/50 text-right' : 'bg-gray-700/50'}`}>
                                                    {msg.text}
                                                </div>
                                            ))}
                                            {isChatting && <div className="p-2 rounded-lg bg-gray-700/50"><Loader className="inline-block"/></div>}
                                        </div>
                                        <form onSubmit={handleChatSubmit} className="flex gap-2">
                                            <input type="text" value={userQuestion} onChange={(e) => setUserQuestion(e.target.value)} placeholder={isListening ? "Dinleniyor..." : "Eser hakkında bir soru sorun..."} className="flex-grow bg-gray-800 border border-gray-600 rounded-lg p-2 text-white focus:ring-2 focus:ring-red-500"/>
                                            <button type="button" onClick={handleVoiceInput} className={`p-3 rounded-lg ${isListening ? 'bg-green-500 animate-pulse' : 'bg-blue-600 hover:bg-blue-700'}`}><Mic /></button>
                                            <button type="submit" disabled={isChatting} className="bg-red-600 p-3 rounded-lg hover:bg-red-700 disabled:opacity-50"><Send /></button>
                                        </form>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }


        // --- ANA UYGULAMA BİLEŞENİ ---
        function App() {
          const [allArtworks, setAllArtworks] = useState([]);
          const [filteredArtworks, setFilteredArtworks] = useState([]);
          const [selectedArtwork, setSelectedArtwork] = useState(null);
          const [filterCategory, setFilterCategory] = useState("Tümü");
          const [isLoading, setIsLoading] = useState(true);
          const [isScanning, setIsScanning] = useState(false);
          const [gloveStatus, setGloveStatus] = useState('Bağlı Değil');
          const [isWelcomeModalOpen, setIsWelcomeModalOpen] = useState(true);
          
          const bgMusicRef = useRef(null);
          const [isBgMusicPlaying, setIsBgMusicPlaying] = useState(false);
          const hoverSound = useRef(null);

          const startAudioContext = useCallback(() => {
            if (Tone.context.state !== 'running') { Tone.start(); }
            if (!hoverSound.current) { hoverSound.current = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 } }).toDestination(); }
          }, []);

          const playHoverSound = useCallback(() => { if (hoverSound.current) { hoverSound.current.triggerAttackRelease("C5", "8n"); } }, []);

          useEffect(() => {
            const repoBaseUrl = "https://raw.githubusercontent.com/Sev84/Holodvision-Duyularin-Harmonisi/main/";
            const artworksData = [
                { "id": 1, "artwork": "Mona Lisa", "qr": "MONA_ORJ", "musicUrl": `${repoBaseUrl}Monalisa%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Monalisa.jpeg`, "artist": "Leonardo da Vinci", "description": "Rönesans döneminin en ünlü portrelerinden biri.", "category": "Klasik" },
                { "id": 2, "artwork": "İnci Küpeli Kız", "qr": "INCI_ORJ", "musicUrl": `${repoBaseUrl}Inci%20Kupeli%20Kız%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Inci%20Kupeli%20Kız.jpeg`, "artist": "Johannes Vermeer", "description": "Hollandalı sanatçının ışık kullanımıyla öne çıkan başyapıtı.", "category": "Klasik" },
                { "id": 3, "artwork": "Picasso - Olga", "qr": "PICA_ORJ", "musicUrl": `${repoBaseUrl}Picasso%20Olga%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Picasso%20Olga.jpg`, "artist": "Pablo Picasso", "description": "Picasso'nun eşi Olga Khokhlova'nın portresi.", "category": "Klasik" },
                { "id": 4, "artwork": "Mona Lisa (Küp Versiyon)", "qr": "MONA_KUP", "musicUrl": `${repoBaseUrl}Monalisa%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Monalisa1.jpg`, "artist": "Leonardo da Vinci", "description": "Mona Lisa tablosunun kübist bir yorumu.", "category": "Kübist" },
                { "id": 5, "artwork": "İnci Küpeli Kız (Küp Versiyon)", "qr": "INCI_KUP", "musicUrl": `${repoBaseUrl}Inci%20Kupeli%20Kız%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Inci%20Kupeli%20Kız1.jpg`, "artist": "Johannes Vermeer", "description": "İnci Küpeli Kız tablosunun kübist bir yorumu.", "category": "Kübist" },
                { "id": 6, "artwork": "Picasso - Olga (Küp Versiyon)", "qr": "PICA_KUP", "musicUrl": `${repoBaseUrl}Picasso%20Olga%20Son%20Hali.mp3`, "imageUrl": `${repoBaseUrl}Picasso%20Olga1.jpg`, "artist": "Pablo Picasso", "description": "Kübist dokunuşlarla modern bir portre çalışması.", "category": "Kübist" }
            ];
            setAllArtworks(artworksData); setIsLoading(false);
          }, []);
          
          useEffect(() => {
            if (!bgMusicRef.current) { bgMusicRef.current = document.getElementById('bg-music-player'); }
            const audioEl = bgMusicRef.current;
            if (audioEl) {
                audioEl.volume = 0.2;
                if (isBgMusicPlaying) { audioEl.play().catch(error => { setIsBgMusicPlaying(false); }); } 
                else { audioEl.pause(); }
            }
          }, [isBgMusicPlaying]);

          useEffect(() => {
            if (filterCategory === "Tümü") { setFilteredArtworks(allArtworks); } 
            else { setFilteredArtworks(allArtworks.filter(item => item.category === filterCategory)); }
          }, [filterCategory, allArtworks]);

          const handleSelectArtwork = (artwork) => {
            setSelectedArtwork(artwork);
          };
          
          const handleScanSuccess = (decodedText) => {
            setIsScanning(false);
            const result = allArtworks.find((item) => item.qr === decodedText);
            if (result) {
                setSelectedArtwork(result);
            } else {
                alert("Eşleşen eser bulunamadı.");
            }
          };

          const handleScanError = (errorMessage) => { setIsScanning(false); alert(errorMessage); };
          const handleGloveConnect = () => {
            setGloveStatus('Bağlanıyor...');
            setTimeout(() => { setGloveStatus(prev => prev === 'Bağlandı' ? 'Bağlı Değil' : 'Bağlandı'); }, 1500);
          };

          const handleCloseWelcomeModal = () => {
            window.speechSynthesis.cancel();
            setIsWelcomeModalOpen(false);
            setIsBgMusicPlaying(true);
            startAudioContext();
          };

          return (
            <div className="bg-[#0c0a18] text-white font-sans">
              <WelcomeModal isOpen={isWelcomeModalOpen} onClose={handleCloseWelcomeModal} />
              <ParticleBackground />
              <Navbar />
              
              <main>
                <AnimatedSection id="home" className="min-h-screen flex items-center justify-center text-center">
                    <div>
                        <img src="https://raw.githubusercontent.com/Sev84/Holodvision-Duyularin-Harmonisi/main/logo1111111.png" alt="PİKSENFONİ Logo" className="mx-auto mb-4 h-28" onError={(e) => { e.target.style.display='none'; }}/>
                        <h1 className="text-5xl md:text-7xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-red-400 to-pink-400 mb-4">PİKSENFONİ</h1>
                        <p className="text-lg md:text-xl text-gray-300 max-w-3xl mx-auto">Renklerle Seslerin Buluştuğu Sınırsız Dünya: Görme engelli bireyler için sanatı işitsel ve dokunsal bir deneyime dönüştürüyoruz.</p>
                    </div>
                </AnimatedSection>
                <AnimatedSection id="project">
                    <h2 className="text-4xl font-bold text-center mb-12">Proje Hakkında</h2>
                    <div className="max-w-5xl mx-auto grid md:grid-cols-3 gap-8">
                        <InfoCard icon={<Eye size={32}/>} title="Amacımız">Görme engelli bireylerin sanata erişimini artırmak ve sanat eserlerini çoklu duyusal yollarla, özgürce deneyimlemelerini sağlamak.</InfoCard>
                        <InfoCard icon={<Cpu size={32}/>} title="Teknolojimiz">RGB renk sensörlü akıllı eldiven, renkleri notalara ve titreşimlere dönüştürür. QR kod tabanlı web uygulamamız ise eserlere özel müziklere anında erişim sunar.</InfoCard>
                        <InfoCard icon={<Users size={32}/>} title="Hedef Kitlemiz">Görme engelli bireyler, özel eğitim kurumları, müzeler, sanat galerileri ve sanata erişilebilir bir pencereden bakmak isteyen herkes.</InfoCard>
                    </div>
                </AnimatedSection>
                <AnimatedSection id="glove" className="bg-black/20">
                    <div className="max-w-2xl mx-auto text-center">
                        <h2 className="text-4xl font-bold mb-4">Renk ve Ses Eldiveni</h2>
                        <p className="text-gray-400 mb-8">Eldiveni kullanarak tablolardaki renklere dokunun ve notaları duyun. Sanatla aranızdaki engelleri kaldırın.</p>
                        <div className="p-6 bg-gray-800/50 backdrop-blur-sm border border-gray-700 rounded-xl inline-flex flex-col items-center gap-4">
                            <button onClick={handleGloveConnect} className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg flex items-center justify-center transition-colors disabled:opacity-50" disabled={gloveStatus === 'Bağlanıyor...'}>
                                <Zap className="mr-2" /> 
                                {gloveStatus === 'Bağlandı' ? 'Bağlantıyı Kes' : 'Eldiveni Bağla'}
                            </button>
                            <div className="flex items-center gap-2">
                                <span className={`w-3 h-3 rounded-full ${gloveStatus === 'Bağlandı' ? 'bg-green-500 animate-pulse' : (gloveStatus === 'Bağlanıyor...' ? 'bg-yellow-500 animate-spin' : 'bg-red-500')}`}></span>
                                <span>{gloveStatus}</span>
                            </div>
                        </div>
                    </div>
                </AnimatedSection>
                <AnimatedSection id="gallery">
                    <h2 className="text-4xl font-bold text-center mb-12">Eser Galerisi</h2>
                    <div className="max-w-5xl mx-auto mb-12 sticky top-20 z-20 bg-gray-900/70 backdrop-blur-md p-4 rounded-xl border border-gray-700">
                        <div className="grid md:grid-cols-2 gap-4 items-end">
                            <div>
                                <label htmlFor="category-filter" className="block mb-2 font-medium text-gray-300">🎨 Kategoriye Göre Filtrele</label>
                                <select id="category-filter" className="w-full p-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:ring-2 focus:ring-red-500 focus:border-red-500 transition" value={filterCategory} onChange={(e) => setFilterCategory(e.target.value)}>
                                    <option value="Tümü">Tümü</option>
                                    <option value="Klasik">Klasik</option>
                                    <option value="Kübist">Kübist</option>
                                </select>
                            </div>
                            <button onClick={() => setIsScanning(true)} className="w-full p-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg flex items-center justify-center transition-colors"> <Camera className="mr-2" /> QR Kod Tara </button>
                        </div>
                    </div>
                    
                    {isLoading ? ( <div className="flex justify-center items-center p-10"><Loader size={48} className="text-red-500"/><p className="ml-4 text-xl">Sanat eserleri yükleniyor...</p></div> ) : (
                      <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
                        {filteredArtworks.map((item) => <ArtCard key={item.id} item={item} onSelect={handleSelectArtwork} onHover={playHoverSound} />)}
                      </div>
                    )}
                </AnimatedSection>
                <AnimatedSection id="contact" className="bg-black/20">
                    <div className="max-w-2xl mx-auto text-center">
                        <h2 className="text-4xl font-bold mb-4">İletişim</h2>
                        <p className="text-gray-400 mb-8">Projemiz hakkında daha fazla bilgi almak veya iş birliği yapmak için bizimle iletişime geçebilirsiniz.</p>
                        <a href="mailto:info@holodvision.com" className="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg transition-colors">Bize Ulaşın</a>
                    </div>
                </AnimatedSection>
              </main>

              <div className="fixed bottom-5 right-5 z-50">
                <button onClick={() => setIsBgMusicPlaying(!isBgMusicPlaying)} className="bg-gray-700/50 hover:bg-gray-600/70 backdrop-blur-sm text-white font-bold p-3 rounded-full shadow-lg transition-colors" aria-label={isBgMusicPlaying ? "Müziği Kapat" : "Müziği Aç"}>
                    {isBgMusicPlaying ? <Volume2 /> : <VolumeX />}
                </button>
              </div>

              <footer className="text-center text-sm text-gray-500 py-8">
                <p>© 2025 PİKSENFONİ - HOLO-D-VISION Takımı. Tüm hakları saklıdır.</p>
                <p>TEKNOFEST Engelsiz Yaşam Teknolojileri Yarışması</p>
              </footer>
              
              {isScanning && <QrScanner onScanSuccess={handleScanSuccess} onScanError={handleScanError} onStop={() => setIsScanning(false)} />}
              {selectedArtwork && <ArtworkDetailModal artwork={selectedArtwork} onClose={() => setSelectedArtwork(null)} bgMusicRef={bgMusicRef} isBgMusicPlaying={isBgMusicPlaying} />}
            </div>
          );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
